# Vulnerability Scanning Operations Guide

## Monitoring & Health Checks

### Key Metrics to Track

#### Performance Metrics
- **Scan Execution Time**: Target <3 minutes, alert if >5 minutes consistently
- **Cache Hit Rate**: Monitor Go module cache effectiveness
- **Parallel Job Timing**: Ensure vulnerability-scan stays parallel with test job

#### Reliability Metrics
- **Scan Success Rate**: Target >99%, investigate if <95%
- **False Positive Rate**: Track vulnerabilities marked as false positives
- **Tool Installation Failures**: Monitor govulncheck installation retry patterns

#### Security Metrics
- **Vulnerabilities Detected**: Count of real vulnerabilities found
- **Time to Resolution**: From detection to fix deployment
- **Coverage Effectiveness**: Ensure scanning catches known issues

### Monitoring Implementation

#### GitHub Actions Insights
Monitor via GitHub Actions dashboard:
- Workflow run times and success rates
- Job-level performance trends
- Artifact generation consistency

#### Log Analysis
Key log patterns to monitor:
```bash
# Success indicators
"✅ govulncheck installed successfully"
"✅ No known vulnerabilities found"

# Warning indicators
"⚠️ Installation failed, retrying"
"cache-hit: no"

# Critical indicators
"❌ CRITICAL: Failed to install govulncheck"
"❌ CRITICAL: Vulnerabilities found"
```

#### Automated Monitoring Script
```bash
#!/bin/bash
# scripts/monitor-vulnerability-scanning.sh
# Run weekly to check scanning health

echo "=== Vulnerability Scanning Health Check ==="
echo "Last 10 workflow runs:"
gh run list --limit 10 --json conclusion,status,createdAt,name

echo -e "\n=== Recent scan artifacts ==="
gh run list --limit 5 --json conclusion | jq '.[] | select(.conclusion != "success") | .conclusion'

echo -e "\n=== Performance analysis ==="
# Add timing analysis logic here
```

## Rollback Procedures

### Immediate Rollback (Emergency)
**Trigger Conditions**:
- CI failure rate >5% due to vulnerability scanning
- Scan execution time >5 minutes consistently
- Critical infrastructure issues blocking development

**Immediate Action** (5 minutes):
1. **Comment out vulnerability scan job**:
   ```yaml
   # EMERGENCY ROLLBACK - Vulnerability scanning temporarily disabled
   # vulnerability-scan:
   #   name: Security Vulnerability Scan
   #   runs-on: ubuntu-latest
   #   needs: lint
   #   steps: ...
   ```

2. **Create emergency PR**:
   ```bash
   git checkout -b emergency-rollback-vuln-scan
   # Edit .github/workflows/ci.yml to comment out job
   git commit -m "emergency: rollback vulnerability scanning due to [REASON]"
   git push origin emergency-rollback-vuln-scan
   # Create PR with emergency label
   ```

3. **Notify team**:
   - Post in development channel
   - Update relevant tickets/issues
   - Document rollback reason and timeline

### Graduated Rollback (Planned)
**For less critical issues requiring investigation**:

1. **Disable failure enforcement only**:
   ```yaml
   # Continue scanning but don't fail builds
   - name: Run vulnerability scan
     run: |
       # ... scanning logic ...
       # Temporarily allow failures while investigating
       exit 0  # Override exit code
   ```

2. **Reduce scan frequency**:
   ```yaml
   # Only scan on manual trigger
   on:
     workflow_dispatch:
   ```

3. **Full rollback if needed** (follow emergency procedure above)

### Rollback Testing
**Monthly validation of rollback procedures**:

1. **Test branch creation**:
   ```bash
   git checkout -b test-rollback-procedure
   # Comment out vulnerability-scan job
   git commit -m "test: validate rollback procedure"
   git push origin test-rollback-procedure
   ```

2. **Verify CI behavior**:
   - Confirm builds pass without vulnerability scanning
   - Check no dependencies break (build job should still work)
   - Validate parallel job structure remains intact

3. **Cleanup**:
   ```bash
   git checkout master
   git branch -D test-rollback-procedure
   git push origin --delete test-rollback-procedure
   ```

## Recovery Procedures

### After Emergency Rollback
1. **Root Cause Analysis**:
   - Review CI logs for failure patterns
   - Check govulncheck tool issues or updates
   - Analyze network/infrastructure problems
   - Document findings in post-mortem

2. **Fix Implementation**:
   - Address identified issues
   - Test fixes in isolated branch
   - Validate with test vulnerability if needed

3. **Gradual Re-enable**:
   - Enable on feature branch first
   - Monitor for 24-48 hours
   - Re-enable on master branch
   - Monitor for 1 week after restoration

### Restore from Commented State
```bash
# Uncomment the vulnerability-scan job
git checkout -b restore-vulnerability-scanning
# Edit .github/workflows/ci.yml to uncomment job
git commit -m "feat: restore vulnerability scanning after [ISSUE] resolution"
git push origin restore-vulnerability-scanning
# Create PR for review
```

## Escalation Procedures

### Level 1: Development Team
- CI consistently failing due to scanning
- Scan times >3 minutes but <5 minutes
- Non-critical tool installation issues

**Action**: Team lead investigates, implements fixes within 24 hours

### Level 2: Security Team
- Critical vulnerabilities detected requiring immediate attention
- Scanning completely non-functional for >4 hours
- Security policy violations detected

**Action**: Security team involvement, coordinate with development for urgent fixes

### Level 3: Engineering Management
- Scanning blocking development for >1 business day
- Multiple emergency rollbacks in short period
- Fundamental tool/process changes needed

**Action**: Management decision on scanning approach, possible process changes

## Regular Maintenance

### Weekly Tasks
- Review scan success rates and timing
- Check for govulncheck tool updates
- Validate artifact retention and accessibility

### Monthly Tasks
- Test rollback procedures
- Review false positive patterns
- Analyze security metrics trends
- Update documentation if needed

### Quarterly Tasks
- Evaluate scanning effectiveness (real vulnerabilities caught)
- Consider Phase 2 enhancement triggers
- Review and update rollback triggers
- Security team retrospective

## Contact Information

- **Development Team**: Standard development channels
- **Security Team**: Security incident response channels
- **Emergency Contacts**: On-call engineering rotation

## Documentation Updates
This document should be updated whenever:
- Rollback procedures are modified
- New monitoring metrics are added
- Escalation contacts change
- Tool versions or configurations change

Last Updated: [Current Date]
Next Review: [Quarterly Review Date]
